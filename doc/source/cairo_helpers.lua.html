<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="../ldoc.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>polycore</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>



<h2>Source</h2>
<ul class="nowrap">
  <li><a href="../source/widget.lua.html">widget.lua</a></li>
  <li><a href="../source/data.lua.html">data.lua</a></li>
  <li><strong>cairo_helpers.lua</strong></li>
  <li><a href="../source/util.lua.html">util.lua</a></li>
</ul>
<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/widget.html">widget</a></li>
  <li><a href="../modules/data.html">data</a></li>
  <li><a href="../modules/cairo_helpers.html">cairo_helpers</a></li>
  <li><a href="../modules/util.html">util</a></li>
</ul>

</div>

<div id="content">

    <h2>cairo_helpers.lua</h2>
<pre>
<span class="comment">--- Cairo helper functions
</span><span class="comment">-- @module cairo_helpers
</span><span class="comment">-- @alias ch
</span>
<span class="keyword">local</span> util = <span class="global">require</span> <span class="string">'util'</span>

<span class="keyword">local</span> ch = {}

<span class="comment">--- Draw a polygon with the given vertices.
</span><span class="comment">-- @tparam cairo_t cr
</span><a id="12"></a><span class="comment">-- @tparam {number,...} coordinates of vertices (x1, y1, x2, y2, ...)
</span><span class="keyword">function</span> ch.polygon(cr, coordinates)
    <span class="comment">-- +.5 for sharp lines, see https://cairographics.org/FAQ/#sharp_lines
</span>    <span class="keyword">local</span> floor = <span class="global">math</span>.floor
    cairo_set_antialias(cr, CAIRO_ANTIALIAS_DEFAULT)
    cairo_move_to(cr, floor(coordinates[<span class="number">1</span>]) + .<span class="number">5</span>, floor(coordinates[<span class="number">2</span>]) + .<span class="number">5</span>)
    <span class="keyword">for</span> i = <span class="number">3</span>, #coordinates, <span class="number">2</span> <span class="keyword">do</span>
        cairo_line_to(cr, floor(coordinates[i]) + .<span class="number">5</span>,
                          floor(coordinates[i + <span class="number">1</span>]) + .<span class="number">5</span>)
    <span class="keyword">end</span>
    cairo_close_path(cr)
<span class="keyword">end</span>

<span class="comment">--- Set a single color gradient with varying opacity
</span><span class="comment">-- on the given cairo drawing context.
</span><span class="comment">-- @tparam cairo_t cr
</span><span class="comment">-- @number x1 x coordinate of gradient start
</span><span class="comment">-- @number y1 y coordinate of gradient start
</span><span class="comment">-- @number x2 x coordinate of gradient end
</span><span class="comment">-- @number y2 y coordinate of gradient end
</span><span class="comment">-- @number r red color component
</span><span class="comment">-- @number g green color component
</span><span class="comment">-- @number b blue color component
</span><span class="comment">-- @tparam {number,...} stops list of offset &amp; alpha value pairs
</span><span class="comment">--          offset between 0 and 1 describes position in the gradient
</span><span class="comment">--          alpha between 0 and 1 describes opacity at given offset.
</span><span class="comment">--          Note: For high/low alpha values the brightness may be emphasized
</span><a id="39"></a><span class="comment">--          by color variation.
</span><span class="keyword">function</span> ch.alpha_gradient(cr, x1, y1, x2, y2, r, g, b, stops)
    <span class="keyword">local</span> gradient = cairo_pattern_create_linear(x1, y1, x2, y2)
    <span class="keyword">for</span> i = <span class="number">1</span>, #stops, <span class="number">2</span> <span class="keyword">do</span>
        <span class="keyword">local</span> offset, alpha = stops[i], stops[i + <span class="number">1</span>]
        <span class="keyword">if</span> alpha &gt; <span class="number">0.5</span> <span class="keyword">then</span>
            <span class="comment">-- additional brightness (white) for peaks
</span>            cairo_pattern_add_color_stop_rgba(gradient, offset, r * <span class="number">1.3</span>, g * <span class="number">1.3</span>, b * <span class="number">1.3</span>, alpha)
        <span class="keyword">else</span>
            cairo_pattern_add_color_stop_rgba(gradient, offset, r, g, b, alpha)
        <span class="keyword">end</span>

    <span class="keyword">end</span>
    cairo_set_source(cr, gradient)
    cairo_pattern_destroy(gradient)
<span class="keyword">end</span>

<span class="comment">--- Reset font settings to defaults on given cairo drawing context
</span><a id="57"></a><span class="comment">-- @tparam cairo_t cr
</span><span class="keyword">function</span> ch.font_normal(cr)
    cairo_select_font_face(cr, default_font_family, CAIRO_FONT_SLANT_NORMAL,
                                                    CAIRO_FONT_WEIGHT_NORMAL)
    cairo_set_font_size(cr, default_font_size)
<span class="keyword">end</span>

<span class="comment">--- Get cairo_font_extents_t for a given font with size.
</span><span class="comment">-- Use this, for example, to determine line-height.
</span><span class="comment">-- see https://cairographics.org/manual/cairo-cairo-scaled-font-t.html#cairo-font-extents-t
</span><span class="comment">-- @function ch.font_extents
</span><span class="comment">-- @string font_family
</span><span class="comment">-- @string font_size
</span><a id="70"></a><span class="comment">-- @treturn cairo_font_extents_t
</span>ch.font_extents = util.memoize(<span class="keyword">function</span>(font_family, font_size)
    <span class="keyword">local</span> tmp_surface = cairo_image_surface_create(CAIRO_FORMAT_ARGB32, <span class="number">100</span>, <span class="number">100</span>)
    <span class="keyword">local</span> tmp_cr = cairo_create(tmp_surface)
    cairo_surface_destroy(tmp_surface)
    cairo_select_font_face(tmp_cr, font_family, CAIRO_FONT_SLANT_NORMAL,
                                                CAIRO_FONT_WEIGHT_NORMAL)
    cairo_set_font_size(tmp_cr, font_size)
    <span class="keyword">local</span> extents = cairo_font_extents_t:create()
    tolua.takeownership(extents)
    cairo_font_extents(tmp_cr, extents)
    cairo_destroy(tmp_cr)
    <span class="keyword">return</span> extents
<span class="keyword">end</span>)

<span class="comment">--- Get cairo_text_extents_t for given text on given cairo drawing surface
</span><span class="comment">-- with its currently set font.
</span><span class="comment">-- See https://cairographics.org/manual/cairo-cairo-scaled-font-t.html#cairo-text-extents-t
</span><span class="comment">-- @tparam cairo_t cr
</span><span class="comment">-- @string text
</span><a id="90"></a><span class="comment">-- @treturn cairo_text_extents_t
</span><span class="keyword">local</span> <span class="keyword">function</span> text_extents(cr, text)
    <span class="keyword">local</span> extents = cairo_text_extents_t:create()
    tolua.takeownership(extents)
    cairo_text_extents(cr, text, extents)
    <span class="keyword">return</span> extents
<span class="keyword">end</span>

<span class="comment">--- Write text left-aligned (to the right of given x).
</span><span class="comment">-- @tparam cairo_t cr
</span><span class="comment">-- @number x start of the written text
</span><span class="comment">-- @number y coordinate of the baseline on top of which the text will be written
</span><a id="102"></a><span class="comment">-- @string text
</span><span class="keyword">function</span> ch.write_left(cr, x, y, text)
    cairo_move_to(cr, x, y)
    cairo_show_text(cr, text)
<span class="keyword">end</span>

<span class="comment">--- Write text right-aligned (to the left of given x).
</span><span class="comment">-- @tparam cairo_t cr
</span><span class="comment">-- @number x end of the written text
</span><span class="comment">-- @number y coordinate of the baseline on top of which the text will be written
</span><a id="112"></a><span class="comment">-- @string text
</span><span class="keyword">function</span> ch.write_right(cr, x, y, text)
    cairo_move_to(cr, x - text_extents(cr, text).width, y)
    cairo_show_text(cr, text)
<span class="keyword">end</span>

<span class="comment">--- Write text centered (spread evenly towards both sides of mx).
</span><span class="comment">-- @tparam cairo_t cr
</span><span class="comment">-- @number mx horizontal center of the written text
</span><span class="comment">-- @number y coordinate of the baseline on top of which the text will be written
</span><a id="122"></a><span class="comment">-- @string text
</span><span class="keyword">function</span> ch.write_centered(cr, mx, y, text)
    <span class="keyword">local</span> extents = text_extents(cr, text)
    <span class="keyword">local</span> x = mx - (extents.width / <span class="number">2</span> + extents.x_bearing)
    cairo_move_to(cr, x, y)
    cairo_show_text(cr, text)
<span class="keyword">end</span>

<span class="comment">--- Write text centered horizontally and vertically on the given point mx, my.
</span><span class="comment">-- @tparam cairo_t cr
</span><span class="comment">-- @number mx horizontal center of the written text
</span><span class="comment">-- @number my vertical center of the written text
</span><a id="134"></a><span class="comment">-- @string text
</span><span class="keyword">function</span> ch.write_middle(cr, mx, my, text)
    <span class="keyword">local</span> extents = text_extents(cr, text)
    <span class="keyword">local</span> x = mx - (extents.width / <span class="number">2</span> + extents.x_bearing)
    <span class="keyword">local</span> y = my - (extents.height / <span class="number">2</span> + extents.y_bearing)
    cairo_move_to(cr, x, y)
    cairo_show_text(cr, text)
<span class="keyword">end</span>

<span class="keyword">return</span> ch</pre>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2019-11-01 17:47:03 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
